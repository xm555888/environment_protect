# 最小MVP开发计划（My Digital Biome）

版本：v1.4（更新：实现最小MVP核心代码与页面接入）
日期：2025-09-10

## 一、项目综述与愿景对齐
- 目标：交付一个网页端、叙事驱动的互动生态模拟器，完成“观察 → 干预 → 加速见证 → 尝试修复”的完整闭环，让非专业用户直观理解食物网、富营养化、缺氧与生态修复等概念。
- MVP强调：隐喻优先而非高保真科学复现，视觉叙事优先于文字说明，数据“讲故事”，快速完成并可对外展示。
- 参考文档：蓝图与四大支柱（知识模型、交互与UX、美术与资产、技术架构）+《交互式生态模拟系统设计报告》（进阶参考；MVP采纳支柱一的简化模型）。

## 二、当前资产与项目现状（已完成/待办）
- 已完成（结构与资产）
  - 初始化脚手架：Next.js（App Router，使用 `src/` 目录）+ TypeScript + Tailwind CSS
  - 安装依赖：`zustand`、`recharts`、`lucide-react`、`class-variance-authority`、`tailwind-merge`、`zod`
  - 初始化 shadcn，并添加基础 UI 组件：`button`、`dialog`、`switch`、`card`、`scroll-area`、`tooltip`
  - 资产搬运（项目根即 Next.js 根）：
    - 公共资源 → `public/assets/{icons,svg,preview}`
    - 应用内部 JSON → `src/app/assets/{content,tokens}`（从根 `assets/` 复制）
  - 基础目录（仅文件夹，无代码）：`src/core`、`src/store`、`src/components/visual`、`src/components/panels`
  - 组件子目录（仅文件夹，无代码）：
    - `src/components/panels/{dashboard,controls,event-log,modals}`
    - `src/components/visual/{background,overlays,biota}`
- 待办（下一步）
  - 建立全局 CSS 变量并对接 `colors.json`（healthy/polluted/collapsed 三主题）
  - 调参与体验打磨：保证“健康→崩溃→部分修复”路径清晰
  - 移除冗余源目录：根 `assets/` 已删除（所有文件已迁移至 `public/` 与 `src/app/assets/`）

## 三、MVP范围与出圈标准
- 必做（Must）
  - 四阶段闭环可交互体验（S1观察、S2单次干预、S3加速见证50年、S4两种修复工具）
  - 简化生态模型与规则（9个变量、每tick规则、一次性“农业径流+60”、修复：曝气+10DO/tick、缓冲带-5营养/tick）
  - 主视觉区：水体状态与植物/鱼类数量的基础可视化（渐变/显隐/数量感）
  - 数据仪表盘：3条折线（`dissolvedOxygen`、`nutrients`、`smallFish`）
  - 控制区：播放/暂停/快进、阶段性按钮（干预、修复开关）
  - 事件日志：基于阈值触发（使用 `events.zh.json` 与 `thresholds.json`）
  - 主题/情绪切换：healthy/polluted/collapsed（藻华/气泡覆盖层联动）
- 可选（Should）
  - 模态过渡动效（水波纹等）、主视觉轻量动效（游速/颜色渐变）
- 不做（Out of scope for MVP）
  - 多生物群系与复杂物理/化学参数；多语言与云存储

## 四、核心模型与数据（MVP落地）
- 时间与采样：`tick=1月`，`ticksPerYear=12`，S3加速x10、见证50年
- 初始状态（健康池塘）：
  - nutrients:20, dissolvedOxygen:80, waterTurbidity:15,
    phytoplankton:25, aquaticPlants:60, zooplankton:30,
    smallFish:50, largeFish:20, decomposers:40
- tick顺序：生产者 → 消费者 → 分解与循环 → 环境变化 → 事件检测/主题切换 → 采样入历史
- 干预/修复：S2营养+60；S4曝气+10DO/tick、缓冲带-5营养/tick（边界裁剪0-100）
- 事件/主题：严格使用 `thresholds.json` 规则

## 五、信息架构与UI（参考支柱二/三）
- 单页布局：顶部（标题/信息按钮）+ 左侧主视觉（≈65%）+ 右侧面板（≈35%：仪表盘/控制/事件日志）
- 文案：模态与日志直接取自 `modals.zh.json`、`events.zh.json`
- 视觉：配色/主题来自 `colors.json`（CSS 变量切换）；icons 使用 `public/assets/icons` 与 `lucide-react`

## 六、技术架构与目录结构（对齐 src/ 结构）
- 依赖建议：Next.js + TS + Tailwind + shadcn/ui + Zustand + Recharts + pnpm
- 目录骨架：
  - `src/core/`（纯TS模拟引擎：`types.ts`、`rules.ts`、`simulation.ts`）
  - `src/store/`（Zustand：`simulationStore.ts`）
  - `src/components/ui/`（shadcn 基础组件）
  - `src/components/visual/`（主视觉、覆盖层、图标挂载）
  - `src/components/panels/`（仪表盘、控制区、事件日志、模态）
  - `src/app/assets/{content,tokens}`（文案/阈值/配色 JSON）
  - `public/assets/{icons,svg,preview}`（静态资源）
  - 全局样式：`src/app/globals.css`（CSS 变量、Tailwind 基样式）
- 数据流：`SimulationEngine (src/core)` ←→ `Zustand Store (src/store)` → `UI Components (src/components)`

## 七、实施里程碑与时间预估（2–4周，单人节奏）
1) M1 引擎核心与阈值配置（1–2天）
   - 建立 `src/core` 类型与规则函数（按支柱一），实现一次tick推进与裁剪（0–100）
   - 读取 `thresholds.json`（时间、事件阈值、主题规则）
   - 控制台脚本验证（临时Node中循环100 tick打印）

2) M2 项目脚手架与UI基线（1–2天）
   - 初始化Next+TS+Tailwind（已完成）
   - 初始化 shadcn/ui（已完成）
   - 复制 `assets/svg|icons` 到 `public/`；复制 `assets/content|tokens` 到 `src/app/assets`（已完成）
   - 建立全局 CSS 变量并加载 `colors.json` 初始主题（待办）

3) M3 状态管理与只读可视化（2–3天）
   - 建立 `simulationStore`（持有 `engine`、`biomeState`、`history`、`gameState`、`isPaused`）
   - `Visualizer` 最小渲染：水体颜色/透明度与变量绑定；植物/鱼类数量或显隐占位渲染
   - `Dashboard`：Recharts 折线图绑定 `history`（三条曲线）

4) M4 交互闭环（2–3天）
   - 控制区：播放/暂停/快进；阶段按钮（S1→S4）
   - 干预：S2 一次性径流；S3 10倍速推进至50年；S4 两项修复工具 Toggle
   - 事件日志：依据阈值触发，`cooldownTicks` 节流
   - 主题切换与覆盖层：`themeRules`、`algaeOverlay`、`bubblesOverlay`

5) M5 体验打磨与验收（2–4天）
   - 三态主题细节、轻量动效、模态流程
   - 数值平衡小迭代（“健康→崩溃→部分修复”路径清晰）

## 八、任务清单（Backlog，可直接抄到Issue）
- 初始化
  - [x] pnpm + Next.js + TS + Tailwind + shadcn/ui 初始化
  - [ ] 全局样式与CSS变量（:root，结合 `colors.json` 建立主题变量）
  - [x] 引入 `assets` 到 `public/` 与 `src/app/assets`（图标/视觉/文案/阈值）
  - [x] 规范化目录到 `src/` 结构（`src/core`、`src/store`、`src/components/*`）
- Core 引擎（src/core）
  - [x] 创建空目录 `src/core/`
  - [x] `types.ts`
  - [x] `rules.ts`
  - [x] `simulation.ts`
  - [x] 单步裁剪与采样（0–100、tick推进）
- Store（src/store）
  - [x] 创建空目录 `src/store/`
  - [x] `simulationStore.ts`
  - [x] 驱动循环（播放/暂停/快进、见证阶段自动推进）
- 组件（src/components）
  - [x] 创建空目录 `src/components/visual/`、`src/components/panels/`
  - [x] `Visualizer`
  - [x] `Dashboard`
  - [x] `Controls`
  - [x] `EventLog`
  - [x] `Modals`
- 体验与可视
  - [ ] 主题切换与CSS变量联动（healthy/polluted/collapsed）
  - [ ] 图标（play/pause/ff/info/alert/settings）对齐（资源已具备）
  - [ ] 字体与间距统一（Inter/Noto Sans）
- 内容
  - [x] 复制 `modals.zh.json` 与 `events.zh.json` 至 `src/app/assets/content`
  - [x] 代码接入触发逻辑（阈值事件、冷却、工具事件）
- 验收
  - [ ] 桌面端（≥1280px）流畅运行；平板分辨率适配
  - [ ] 50年见证阶段曲线与主视觉变化一致且可读
  - [ ] 干预后崩溃清晰、修复后部分回稳（非完全恢复）

## 九、验收标准（Definition of Done）
- 闭环体验完整、无卡死路径
- 可视一致（主题、主视觉与仪表曲线统一表达生态状态）
- 事件可读（关键事件在恰当时机触发，分类高亮）
- 性能稳定（桌面端视觉层流畅；图表无明显卡顿）
- 工程规范（TS类型完备，核心逻辑与UI解耦）

## 十、风险与缓解
- 数值平衡不理想 → 预留 1–2 天“调参回合”，以曲线可读性优先
- 主题切换不自然 → 使用CSS变量 + 过渡控制；限制动画数量与频率
- 事件刷屏 → 使用 `cooldownTicks` 限流；合并同类项
- 图表性能 → MVP仅3条关键曲线；历史点数按阈值截断

## 十一、后续扩展（非MVP）
- 新干预/修复工具、资源/成本系统、结局评分
- 更丰富物种与营养级、温度/pH/季节模型
- 多语言与分享导出（图表快照、回放）

## 十二、开放问题（请确认）
- 目标设备：是否仅桌面与平板，移动暂不适配？
- 语言范围：MVP是否仅中文？是否需要英文占位？
- 动效优先级：是否投入水波纹等转场动画？
- shadcn 组件集：是否继续拉取额外组件（Tabs/Sheet/Toast 等）？

## 十三、建议的初始化命令（记录用，不在本次实现中执行）
- 脚手架：`pnpm dlx create-next-app@latest my-digital-biome --ts --app --tailwind --eslint --use-pnpm --src-dir --import-alias "@/*"`
- 安装：`pnpm add zustand recharts lucide-react class-variance-authority tailwind-merge zod`
- shadcn：`pnpm dlx shadcn@latest init -y -b neutral`，随后 `pnpm dlx shadcn@latest add button dialog switch card scroll-area tooltip`

—— 本计划在 v1.1 中同步了已完成的脚手架、依赖与资产迁移，并将目录规范调整为 `src/` 结构；接下来仅需按任务清单逐步补齐空壳文件与实现逻辑。
